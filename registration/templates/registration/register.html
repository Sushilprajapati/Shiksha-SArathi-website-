{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Competition Registration</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Slideshow */
.slide-image { position: absolute; width:100%; height:100%; object-fit:cover; opacity:0; transition: opacity 1.2s ease-in-out, transform 20s ease; transform: scale(1); }
.slide-image.active { opacity:1; transform: scale(1.05); }
.animate-fadeIn { animation: fadeIn 1.2s ease forwards; }
@keyframes fadeIn { from {opacity:0; transform: translateY(16px);} to {opacity:1; transform: translateY(0);} }

/* Icon hover */
.input-icon { transition: transform .25s, color .25s; }
.input-icon:hover { transform: scale(1.15) rotate(6deg); color:#2563eb; }

/* valid/invalid outlines */
.field-valid { border-color: #10b981 !important; box-shadow: 0 0 0 4px rgba(16,185,129,0.08); }
.field-invalid { border-color: #ef4444 !important; box-shadow: 0 0 0 4px rgba(239,68,68,0.06); }

/* small inline message */
.inline-msg { font-size: 0.8rem; margin-top: 0.25rem; }

/* success popup animation */
#successMessage > div { transform: translateY(-8px); transition: transform .25s ease; }
#successMessage.show > div { transform: translateY(0); }

/* keep layout */
body { font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
</style>
</head>
<body class="min-h-screen relative">

<!-- Background slideshow -->
<div class="absolute inset-0">
    <img src="https://images.unsplash.com/photo-1596495577886-d920f0d6c35c?auto=format&fit=crop&w=1350&q=80" class="slide-image active">
    <img src="https://images.unsplash.com/photo-1573164574572-cb89e39749b4?auto=format&fit=crop&w=1350&q=80" class="slide-image">
    <img src="https://images.unsplash.com/photo-1604079620034-2d2e399d3b50?auto=format&fit=crop&w=1350&q=80" class="slide-image">
    <div class="absolute inset-0 bg-black bg-opacity-40"></div>
</div>

<!-- Form container -->
<div class="relative z-10 flex flex-col items-center justify-center min-h-screen px-4">
    <div class="bg-white bg-opacity-95 backdrop-blur-md p-8 md:p-10 rounded-3xl shadow-2xl w-full max-w-xl animate-fadeIn">
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-extrabold text-center mb-6 md:mb-8">üèÜ Competition Registration</h1>

        <!-- <form method="POST" enctype="multipart/form-data" id="registrationForm" class="space-y-4"> -->
            <form method="POST" enctype="multipart/form-data" id="registrationForm" class="space-y-4" action="{% url 'register' %}">

            {% csrf_token %}

            {% for field in form %}
            <!-- wrapper: keep consistent classes so JS can style wrapper -->
            <div class="field-wrapper flex items-center border-2 border-gray-300 rounded-lg p-2 transition">
                {% if field.name == 'full_name' %}
                    <i class="fa fa-user text-blue-500 text-xl mr-3 input-icon"></i>
                {% elif field.name == 'dob' %}
                    <i class="fa fa-calendar-alt text-green-500 text-xl mr-3 input-icon"></i>
                {% elif field.name == 'gender' %}
                    <i class="fa fa-venus-mars text-pink-500 text-xl mr-3 input-icon"></i>
                {% elif field.name == 'photo' %}
                    <i class="fa fa-image text-purple-500 text-xl mr-3 input-icon"></i>
                {% elif field.name == 'school_name' %}
                    <i class="fa fa-school text-yellow-500 text-xl mr-3 input-icon"></i>
                {% elif field.name == 'school_class' %}
                    <i class="fa fa-chalkboard text-indigo-500 text-xl mr-3 input-icon"></i>
                {% elif field.name == 'school_address' %}
                    <i class="fa fa-map-marker-alt text-red-500 text-xl mr-3 input-icon"></i>
                {% elif field.name == 'phone_number' %}
                    <i class="fa fa-phone text-green-500 text-xl mr-3 input-icon"></i>
                {% endif %}

                <div class="flex-1">
                    {{ field }}
                    <div class="inline-msg text-sm text-red-600 mt-1" id="error-{{ field.name }}"></div>
                </div>
            </div>
            {% endfor %}

            <button id="submitBtn" type="submit" class="w-full mt-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold py-3 rounded-xl shadow hover:shadow-lg transition transform hover:-translate-y-0.5">
                Register Now
            </button>
        </form>
    </div>
</div>

<!-- Success popup -->
<div id="successMessage" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 md:p-8 rounded-2xl shadow-xl text-center">
        <h3 class="text-xl font-bold text-green-600 mb-2">Registration Successful!</h3>
        <p class="text-sm text-gray-700">Thank you ‚Äî we received your registration.</p>
        <button onclick="closeSuccess()" class="mt-4 px-4 py-2 bg-green-500 text-white rounded-lg">Close</button>
    </div>
</div>

<script>
// ---------- Slideshow ----------
let slides = document.querySelectorAll('.slide-image');
let slideIndex = 0;
setInterval(() => {
    slides[slideIndex].classList.remove('active');
    slideIndex = (slideIndex + 1) % slides.length;
    slides[slideIndex].classList.add('active');
}, 7000);

// ---------- Helper validators (client-side) ----------
const validators = {
    full_name: function(v) {
        if(!v || v.trim().length < 2) return "Enter full name (min 2 chars).";
        if(!/^[A-Za-z\s\.]+$/.test(v)) return "Name can contain letters, spaces and dots only.";
        return "";
    },
    dob: function(v) {
        if(!v) return "Date of birth required.";
        const d = new Date(v);
        const today = new Date();
        if(isNaN(d.getTime())) return "Invalid date.";
        if(d > today) return "Date of birth cannot be in the future.";
        let age = today.getFullYear() - d.getFullYear();
        const m = today.getMonth() - d.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < d.getDate())) age--;
        if(age < 5) return "Participant must be at least 5 years old.";
        return "";
    },
    gender: function(v) { if(!v || v === "") return "Select gender."; return ""; },
    photo: function(fileInput) {
        const f = fileInput.files[0];
        if(!f) return "Please upload a photo.";
        const allowed = ['image/jpeg','image/png'];
        if(!allowed.includes(f.type)) return "Only JPG or PNG images are allowed.";
        const maxBytes = 5 * 1024 * 1024;
        if(f.size > maxBytes) return "Photo must be <= 5 MB.";
        return "";
    },
    school_name: function(v) {
        if(!v || v.trim().length < 2) return "Enter school name (min 2 chars).";
        if(!/^[A-Za-z0-9\s\.\-&()]+$/.test(v)) return "School name has invalid characters.";
        return "";
    },
    school_class: function(v) {
        if(v === null || v === undefined || v === "") return "Enter class (1-12).";
        const n = Number(v);
        if(isNaN(n) || !Number.isInteger(n)) return "Class must be an integer.";
        if(n < 1 || n > 12) return "Class must be between 1 and 12.";
        return "";
    },
    school_address: function(v) {
        if(!v || v.trim().length < 5) return "Address must be at least 5 characters.";
        return "";
    },
    phone_number: function(v) {
        if(!v) return "Phone number required.";
        if(!/^\d{10}$/.test(v)) return "Enter a valid 10-digit phone number.";
        return "";
    }
};

// ---------- Wire up live validation ----------
document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('registrationForm');

    const fields = {};
    Array.from(form.querySelectorAll('input, select, textarea')).forEach(el => {
        if(!el.name) return;
        fields[el.name] = el;
        const eventName = (el.type === 'file' || el.tagName.toLowerCase()==='select') ? 'change' : 'input';
        el.addEventListener(eventName, () => validateField(el));
    });

    function validateField(el) {
        const name = el.name;
        let msg = (name === 'photo') ? validators.photo(el) : validators[name](el.value);
        const wrapper = el.closest('.field-wrapper');
        const errorDiv = document.getElementById('error-' + name);
        if(msg) {
            errorDiv.textContent = msg;
            wrapper.classList.remove('field-valid');
            wrapper.classList.add('field-invalid');
        } else {
            errorDiv.textContent = "";
            wrapper.classList.remove('field-invalid');
            wrapper.classList.add('field-valid');
        }
        return msg === "";
    }

    // ‚úÖ Final submit
    form.addEventListener('submit', (e) => {
        let ok = true;
        for(const n in fields) {
            const el = fields[n];
            const valid = validateField(el);
            if(!valid) ok = false;
        }
        if(!ok) {
            const firstInvalid = document.querySelector('.field-invalid');
            if(firstInvalid) firstInvalid.scrollIntoView({behavior:'smooth', block:'center'});
            return;
        }

        // ‚úÖ ab actual Django ko submit hoga & redirect hoga
        form.submit();
    });
});

function closeSuccess() {
    const popup = document.getElementById('successMessage');
    popup.classList.add('hidden');
    popup.classList.remove('show');
}
</script>

</body>
</html>
